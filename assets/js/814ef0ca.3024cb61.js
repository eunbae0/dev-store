"use strict";(self.webpackChunkdev_store=self.webpackChunkdev_store||[]).push([[3536],{9652:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var r=t(6560),i=t(8432);const s={},a="React Native Under the Hood",o={id:"react_native/til/react_native_under_the_hood",title:"React Native Under the Hood",description:"\uc774\uadfc\ud601\ub2d8\uc758 \ud574\ub2f9 \uae00\uc744 \uc77d\uace0, \uac04\ub2e8 \uc815\ub9ac",source:"@site/docs/react_native/til/react_native_under_the_hood.md",sourceDirName:"react_native/til",slug:"/react_native/til/react_native_under_the_hood",permalink:"/dev-store/docs/react_native/til/react_native_under_the_hood",draft:!1,unlisted:!1,editUrl:"https://github.com/eunbae0/dev-store/tree/main/docs/react_native/til/react_native_under_the_hood.md",tags:[],version:"current",frontMatter:{},sidebar:"rnSidebar",previous:{title:"TIL",permalink:"/dev-store/docs/category/til"},next:{title:"upgrade to RN 0.74",permalink:"/dev-store/docs/react_native/til/upgrade_0.74"}},l={},c=[{value:"\ubc88\ub4e4\ub7ec (Bundler)",id:"\ubc88\ub4e4\ub7ec-bundler",level:2},{value:"\ub7f0\ud0c0\uc784",id:"\ub7f0\ud0c0\uc784",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",del:"del",h1:"h1",h2:"h2",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"react-native-under-the-hood",children:"React Native Under the Hood"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\uc774\uadfc\ud601\ub2d8\uc758 ",(0,r.jsx)(n.a,{href:"https://codevkr.tistory.com/126?category=1063241",children:"\ud574\ub2f9 \uae00"}),"\uc744 \uc77d\uace0, \uac04\ub2e8 \uc815\ub9ac"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\ubc88\ub4e4\ub7ec-bundler",children:"\ubc88\ub4e4\ub7ec (Bundler)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"react_native_under_the_hood_1.png",src:t(9632).c+""})}),"\n",(0,r.jsx)(n.p,{children:"React Native\uc758 \uae30\ubcf8 \ubc88\ub4e4\ub7ec\uc778 Metro\ub294 \uc544\ub798\uc640 \uac19\uc740 \uacfc\uc815\uc744 \uac70\uccd0 \ubc88\ub4e4\ub9c1\uc744 \uc218\ud589\ud55c\ub2e4."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ubaa8\ub4c8 \ud574\uc11d(module Resolve)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"import \uad6c\ubb38 \ucc3e\uae30"}),"\n",(0,r.jsx)(n.li,{children:"\u2026tree shaking x"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\uc8fc\uc785(inject)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Polyfill","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"object.es8.js"}),"\n",(0,r.jsxs)(n.li,{children:["console.js","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\uc801\uc6a9 \uc644\ub8cc\ub418\uc5c8\ub2e4\uba74 console \uac1d\uccb4\uc5d0 _isPolyfilled \uc18d\uc131\uc744 true\ub85c \uc124\uc815\ud55c\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"error-guard.js"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"react native \ucd08\uae30\ud654 - InitializeCore.js(RN) \u21d2 loadMetroConfig.ts(Metro)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\ubcc0\ud658(transform)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["babel\uc744 \ud1b5\ud574 \ucc98\ub9ac, ",(0,r.jsx)(n.del,{children:"metro-react-native-babel-preset"})," >> @react-native/babel-preset"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\uc0ac\uc804 \ucef4\ud30c\uc77c(pre-compilation \u21d2 hermes Engine)",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.img,{alt:"react_native_under_the_hood_4.gif",src:t(7598).c+""}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Hermes Engine\uc740 \ube4c\ub4dc\ud0c0\uc784\uc5d0 \ubbf8\ub9ac parse, compile\uae4c\uc9c0 \uc9c4\ud589 \u21d2 \uc989\uc2dc \uc2e4\ud589\uac00\ub2a5\ud55c Bytecode \ud615\ud0dc\ub85c \ubcc0\ud658"}),"\n",(0,r.jsx)(n.li,{children:"release\ub9cc O, debug\ud658\uacbd\uc5d0\uc11c\ub294 X"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\uac1c\ubc1c \uc11c\ubc84","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Metro \uc11c\ubc84\uc5d0\uc11c \ube4c\ub4dc\ub97c \uc9c4\ud589 \ud6c4, localhost:8080\uc744 \ud1b5\ud574 \ubc88\ub4e4\uc744 \uc804\ub2ec\ud568"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\ub7f0\ud0c0\uc784",children:"\ub7f0\ud0c0\uc784"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"react_native_under_the_hood_2.png",src:t(2104).c+""})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\ub124\uc774\ud2f0\ube0c"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["core instance \uc0dd\uc131(Android: JNI\ub97c \uc774\uc6a9), ",(0,r.jsx)(n.strong,{children:"\uc0dd\uc131 \ud6c4 \ub7f0\ud0c0\uc784\uacfc \uad00\ub828\ub41c \ubaa8\ub4c8\ub4e4\uc774 \uad6c\uc131\ub41c\ub2e4."}),"\n",(0,r.jsx)(n.img,{alt:"react_native_under_the_hood_3.png",src:t(13).c+""})]}),"\n",(0,r.jsx)(n.li,{children:"JSI(JavaScript Interface)\ub294 \uc790\ubc14\uc2a4\ud06c\ub9bd\ud2b8 \uc5d4\uc9c4\uc758 \uc778\ud130\ud398\uc774\uc2a4\ub97c \ucd94\uc0c1\ud654\ud55c API\uc778\ub370, \uc774\ub97c \ud1b5\ud574 \ubcf5\uc7a1\ud55c \ucf54\ub4dc \uad6c\ud604 \uc5c6\uc774 JSI\ub97c \ud1b5\ud574 \uc790\ubc14\uc2a4\ud06c\ub9bd\ud2b8 \ub7f0\ud0c0\uc784\uacfc \uc0c1\ud638\uc791\uc6a9 \ud560 \uc218 \uc788\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\uc790\ubc14\uc2a4\ud06c\ub9bd\ud2b8 \ub7f0\ud0c0\uc784(JS Engine)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\uc790\ubc14\uc2a4\ud06c\ub9bd\ud2b8 \ub7f0\ud0c0\uc784(\uc5d4\uc9c4)\uc740 \uc131\ub2a5\uc744 \uc704\ud574 \ub300\ubd80\ubd84 C/C++ \uae30\ubc18\uc73c\ub85c \uad6c\ud604\ub418\uc5b4 \uc788\ub2e4.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JSC(JavaScript Core)"}),"\n",(0,r.jsx)(n.li,{children:"Hermes"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\ubaa8\ub450 JSExecutorFactory\ub97c \ud1b5\ud574 \ub7f0\ud0c0\uc784 \uc778\uc2a4\ud134\uc2a4\uac00 \uc0dd\uc131\ub41c\ub2e4","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"proxy runtime \u2192 V8(debug only)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"makeJSCRuntime() - JSCRuntime.cpp"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"class JSCRuntime : public jsi::Runtime {\n// ...\nstd::unique_ptr<jsi::Runtime> makeJSCRuntime() {\n  return std::make_unique<JSCRuntime>();\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"JSCExecutorFactory() - JSCExecutorFactory.mm"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"namespace facebook::react {\n\nstd::unique_ptr<JSExecutor> JSCExecutorFactory::createJSExecutor(\n    std::shared_ptr<ExecutorDelegate> delegate,\n    std::shared_ptr<MessageQueueThread> __unused jsQueue)\n{\n  return std::make_unique<JSIExecutor>(\n      facebook::jsc::makeJSCRuntime(), delegate, JSIExecutor::defaultTimeoutInvoker, runtimeInstaller_);\n}\n\n}\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"RCTAppSetupDefaultJsExecutorFactory() - RCTAppSetupUtils.mm"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'std::unique_ptr<facebook::react::JSExecutorFactory> RCTAppSetupDefaultJsExecutorFactory(\n    RCTBridge *bridge,\n    RCTTurboModuleManager *turboModuleManager,\n    const std::shared_ptr<facebook::react::RuntimeScheduler> &runtimeScheduler)\n{\n  // Necessary to allow NativeModules to lookup TurboModules\n  [bridge setRCTTurboModuleRegistry:turboModuleManager];\n\n#if RCT_DEV\n  /**\n   * Instantiating DevMenu has the side-effect of registering\n   * shortcuts for CMD + d, CMD + i,  and CMD + n via RCTDevMenu.\n   * Therefore, when TurboModules are enabled, we must manually create this\n   * NativeModule.\n   */\n  [turboModuleManager moduleForName:"RCTDevMenu"];\n#endif // end RCT_DEV\n\n#if USE_HERMES\n  return std::make_unique<facebook::react::HermesExecutorFactory>(\n#else\n  return std::make_unique<facebook::react::JSCExecutorFactory>(\n#endif // USE_HERMES\n    facebook::react::RCTJSIExecutorRuntimeInstaller(\n      [turboModuleManager, bridge, runtimeScheduler](facebook::jsi::Runtime &runtime) {\n        if (!bridge || !turboModuleManager) {\n          return;\n        }\n        if (runtimeScheduler) {\n          facebook::react::RuntimeSchedulerBinding::createAndInstallIfNeeded(runtime, runtimeScheduler);\n        }\n        [turboModuleManager installJSBindings:runtime];\n      }));\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"jsExecutorFactoryForBridge() - RCTRootViewFactory.mm"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'#pragma mark - RCTCxxBridgeDelegate\n- (std::unique_ptr<facebook::react::JSExecutorFactory>)jsExecutorFactoryForBridge:(RCTBridge *)bridge\n{\n  _runtimeScheduler = std::make_shared<facebook::react::RuntimeScheduler>(RCTRuntimeExecutorFromBridge(bridge));\n  if (RCTIsNewArchEnabled()) {\n    std::shared_ptr<facebook::react::CallInvoker> callInvoker =\n        std::make_shared<facebook::react::RuntimeSchedulerCallInvoker>(_runtimeScheduler);\n    RCTTurboModuleManager *turboModuleManager =\n        [[RCTTurboModuleManager alloc] initWithBridge:bridge\n                                             delegate:_turboModuleManagerDelegate\n                                            jsInvoker:callInvoker];\n    _contextContainer->erase("RuntimeScheduler");\n    _contextContainer->insert("RuntimeScheduler", _runtimeScheduler);\n    return RCTAppSetupDefaultJsExecutorFactory(bridge, turboModuleManager, _runtimeScheduler);\n  } else {\n    return RCTAppSetupJsExecutorFactoryForOldArch(bridge, _runtimeScheduler);\n  }\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"start() - RCTCxxBridge.mm"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"  // Prepare executor factory (shared_ptr for copy into block)\n  std::shared_ptr<JSExecutorFactory> executorFactory;\n  if (!self.executorClass) {\n    if ([self.delegate conformsToProtocol:@protocol(RCTCxxBridgeDelegate)]) {\n      id<RCTCxxBridgeDelegate> cxxDelegate = (id<RCTCxxBridgeDelegate>)self.delegate;\n      executorFactory = [cxxDelegate jsExecutorFactoryForBridge:self];\n    }\n    if (!executorFactory) {\n      auto installBindings = RCTJSIExecutorRuntimeInstaller(nullptr);\n#if USE_HERMES\n      executorFactory = std::make_shared<HermesExecutorFactory>(installBindings);\n#else\n      executorFactory = std::make_shared<JSCExecutorFactory>(installBindings);\n#endif\n    }\n  } else {\n    id<RCTJavaScriptExecutor> objcExecutor = [self moduleForClass:self.executorClass];\n    executorFactory.reset(new RCTObjcExecutorFactory(objcExecutor, ^(NSError *error) {\n      if (error) {\n        [weakSelf handleError:error];\n      }\n    }));\n  }\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"JSExecutorFactory() - JSExecutor.h"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"class JSExecutorFactory {\n public:\n  virtual std::unique_ptr<JSExecutor> createJSExecutor(\n      std::shared_ptr<ExecutorDelegate> delegate,\n      std::shared_ptr<MessageQueueThread> jsQueue) = 0;\n  virtual ~JSExecutorFactory() {}\n};\n\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'class RN_EXPORT JSExecutor {\n public:\n  /**\n   * Prepares the JS runtime for React Native by installing global variables.\n   * Called once before any JS is evaluated.\n   */\n  virtual void initializeRuntime() = 0;\n  /**\n   * Execute an application script bundle in the JS context.\n   */\n  virtual void loadBundle(\n      std::unique_ptr<const JSBigString> script,\n      std::string sourceURL) = 0;\n\n  /**\n   * Add an application "RAM" bundle registry\n   */\n  virtual void setBundleRegistry(\n      std::unique_ptr<RAMBundleRegistry> bundleRegistry) = 0;\n\n  /**\n   * Register a file path for an additional "RAM" bundle\n   */\n  virtual void registerBundle(\n      uint32_t bundleId,\n      const std::string& bundlePath) = 0;\n\n  /**\n   * Executes BatchedBridge.callFunctionReturnFlushedQueue with the module ID,\n   * method ID and optional additional arguments in JS. The executor is\n   * responsible for using Bridge->callNativeModules to invoke any necessary\n   * native modules methods.\n   */\n  virtual void callFunction(\n      const std::string& moduleId,\n      const std::string& methodId,\n      const folly::dynamic& arguments) = 0;\n\n  /**\n   * Executes BatchedBridge.invokeCallbackAndReturnFlushedQueue with the cbID,\n   * and optional additional arguments in JS and returns the next queue. The\n   * executor is responsible for using Bridge->callNativeModules to invoke any\n   * necessary native modules methods.\n   */\n  virtual void invokeCallback(\n      const double callbackId,\n      const folly::dynamic& arguments) = 0;\n\n  virtual void setGlobalVariable(\n      std::string propName,\n      std::unique_ptr<const JSBigString> jsonValue) = 0;\n\n  virtual void* getJavaScriptContext() {\n    return nullptr;\n  }\n\n  /**\n   * Returns whether or not the underlying executor supports debugging via the\n   * Chrome remote debugging protocol. If true, the executor should also\n   * override the \\c createAgentDelegate method.\n   */\n  virtual bool isInspectable() {\n    return false;\n  }\n\n  /**\n   * The description is displayed in the dev menu, if there is one in\n   * this build.  There is a default, but if this method returns a\n   * non-empty string, it will be used instead.\n   */\n  virtual std::string getDescription() = 0;\n\n  virtual void handleMemoryPressure([[maybe_unused]] int pressureLevel) {}\n\n  virtual void destroy() {}\n  virtual ~JSExecutor() = default;\n\n  virtual void flush() {}\n\n  static std::string getSyntheticBundlePath(\n      uint32_t bundleId,\n      const std::string& bundlePath);\n\n  static double performanceNow();\n\n  /**\n   * Get a reference to the \\c RuntimeTargetDelegate owned (or implemented) by\n   * this executor. This reference must remain valid for the duration of the\n   * executor\'s lifetime.\n   */\n  virtual jsinspector_modern::RuntimeTargetDelegate& getRuntimeTargetDelegate();\n\n private:\n  /**\n   * Initialized by \\c getRuntimeTargetDelegate if not overridden, and then\n   * never changes.\n   */\n  std::optional<jsinspector_modern::FallbackRuntimeTargetDelegate>\n      runtimeTargetDelegate_;\n};\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\ucd08\uae30 \uc571 \uc2e4\ud589 \uc2dc \ub7f0\ud0c0\uc784(JSC \ud639\uc740 Hermes)\uc774 \ucd08\uae30\ud654\ub418\uace0 \uc774\ub4e4\uacfc \uc0c1\ud638\uc791\uc6a9 \ud560 \uc218 \uc788\ub294 \uae30\ubc18\uc774 \ub9c8\ub828\ub418\uba70, \uc0c1\ud638\uc791\uc6a9\uc740 \ud504\ub85c\uc81d\ud2b8 \uad6c\uc131\uc5d0 \ub530\ub978 \ud329\ud1a0\ub9ac\uc5d0\uc11c \uc0dd\uc131\ub41c\xa0",(0,r.jsx)(n.code,{children:"JSExecutor"}),"\xa0\ub97c \ud1b5\ud574 \uc774\ub8e8\uc5b4\uc9c4\ub2e4."]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},9632:(e,n,t)=>{t.d(n,{c:()=>r});const r=t.p+"assets/images/react_native_under_the_hood_1-999461f2e43e570f53bd8ae22b5b2c07.png"},2104:(e,n,t)=>{t.d(n,{c:()=>r});const r=t.p+"assets/images/react_native_under_the_hood_2-5eca1fdc5c529fb2aec08943d098fa60.png"},13:(e,n,t)=>{t.d(n,{c:()=>r});const r=t.p+"assets/images/react_native_under_the_hood_3-d33b62d6ba06e3761f210ac044b2b9e7.png"},7598:(e,n,t)=>{t.d(n,{c:()=>r});const r=t.p+"assets/images/react_native_under_the_hood_4-dd8a12fd214a1ba4ddb7eecacbf65ba7.gif"},8432:(e,n,t)=>{t.d(n,{I:()=>o,M:()=>a});var r=t(4424);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);